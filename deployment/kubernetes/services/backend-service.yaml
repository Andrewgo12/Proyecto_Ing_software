# Backend API Services for Sistema de Inventario PYMES

apiVersion: v1
kind: Service
metadata:
  name: backend-service
  namespace: inventario-pymes
  labels:
    app.kubernetes.io/name: inventario-pymes
    app.kubernetes.io/component: backend-service
    app.kubernetes.io/version: "1.0.0"
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    service.beta.kubernetes.io/aws-load-balancer-backend-protocol: "http"
spec:
  type: ClusterIP
  ports:
  - port: 3001
    targetPort: 3001
    protocol: TCP
    name: http
  selector:
    app.kubernetes.io/name: inventario-pymes
    app.kubernetes.io/component: backend
  sessionAffinity: None

---
# Service for Backend metrics
apiVersion: v1
kind: Service
metadata:
  name: backend-metrics
  namespace: inventario-pymes
  labels:
    app.kubernetes.io/name: inventario-pymes
    app.kubernetes.io/component: backend-metrics
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9090"
    prometheus.io/path: "/metrics"
spec:
  type: ClusterIP
  ports:
  - port: 9090
    targetPort: 9090
    protocol: TCP
    name: metrics
  selector:
    app.kubernetes.io/name: inventario-pymes
    app.kubernetes.io/component: backend

---
# Redis Service
apiVersion: v1
kind: Service
metadata:
  name: redis-service
  namespace: inventario-pymes
  labels:
    app.kubernetes.io/name: inventario-pymes
    app.kubernetes.io/component: redis-service
    app.kubernetes.io/version: "7"
spec:
  type: ClusterIP
  ports:
  - port: 6379
    targetPort: 6379
    protocol: TCP
    name: redis
  selector:
    app.kubernetes.io/name: inventario-pymes
    app.kubernetes.io/component: redis
  sessionAffinity: None

---
# Service for Redis metrics
apiVersion: v1
kind: Service
metadata:
  name: redis-metrics
  namespace: inventario-pymes
  labels:
    app.kubernetes.io/name: inventario-pymes
    app.kubernetes.io/component: redis-metrics
  annotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9121"
    prometheus.io/path: "/metrics"
spec:
  type: ClusterIP
  ports:
  - port: 9121
    targetPort: 9121
    protocol: TCP
    name: metrics
  selector:
    app.kubernetes.io/name: inventario-pymes
    app.kubernetes.io/component: redis